# rc_control_stack/config/control_stack.yaml

control_stack_node:
  ros__parameters:
    # 입력 토픽
    mission_state_topic: /mission/state
    turn_target_topic: /mission/turn_target_rad
    enable_drive_topic: /control/enable_drive
    lane_topic: /perception/lane
    marker_status_topic: /perception/marker_status
    parking_line_topic: /perception/parking_line
    slot_marker_topic: /perception/slot_marker_pose
    
    # 출력 토픽
    drive_cmd_topic: /control/drive_cmd
    driving_state_topic: /driving/state
    align_done_topic: /mission/align_done
    
    # 제어 주기
    control_rate_hz: 30.0
    state_publish_rate_hz: 10.0
    
    # Timeout
    lane_timeout_sec: 0.5
    marker_timeout_sec: 1.0
    
    # ===== Lane Follow (Stanley-lite) =====
    lane_vx: 0.15          # 기본 전진 속도 (m/s)
    lane_k_psi: 0.8        # heading 게인
    lane_k_y: 1.2          # crosstrack 게인
    lane_v0: 0.1           # softening 상수
    
    # ===== Turning =====
    turn_wz: 0.5           # 회전 각속도 (rad/s)
    turn_tolerance_rad: 0.1
    
    # ===== Advance to Center =====
    advance_vx: 0.10
    advance_target_z: 0.15   # 마커까지 목표 거리 (m)
    advance_tolerance_z: 0.03
    
    # ===== Align to Marker =====
    align_kp_x: 0.8
    align_kp_y: 0.6
    align_kp_yaw: 0.5
    align_tolerance_xy: 0.02
    align_tolerance_yaw: 0.08
    align_max_v: 0.12
    
    # ===== Park - Line Align =====
    park_line_vy: 0.08
    park_line_kp_offset: 0.5
    park_line_kp_angle: 0.3
    park_line_tolerance_offset: 0.05
    park_line_tolerance_angle: 0.1
    
    # ===== Park - Slot Marker =====
    park_slot_vx: 0.06
    park_slot_target_x: 0.10
    park_slot_tolerance: 0.02
    
    # ===== Safety Limits =====
    max_vx: 0.3
    max_vy: 0.3
    max_wz: 1.0
    
    # Frame
    base_frame: base_link
    
    # Logging
    log_throttle_sec: 1.0


safety_manager_node:
  ros__parameters:
    # 토픽
    auto_cmd_topic: /control/drive_cmd
    emergency_cmd_topic: /control/drive_cmd_emergency
    safe_cmd_topic: /control/drive_cmd_safe
    imu_topic: /imu/data
    
    # Timeout
    watchdog_timeout_sec: 0.2
    emergency_timeout_sec: 0.3
    
    # Slew rate (units/sec)
    slew_rate_vx: 1.0
    slew_rate_vy: 1.0
    slew_rate_wz: 3.0
    
    # Speed limits
    max_vx: 0.3
    max_vy: 0.3
    max_wz: 1.5
    
    # IMU Heading Hold
    use_imu_heading_hold: true
    heading_hold_kp: 0.5
    heading_hold_ki: 0.05
    heading_hold_threshold_wz: 0.12
    heading_hold_min_v: 0.10
    heading_hold_max_vy: 0.20
    imu_timeout_sec: 0.2
    
    # 주기
    publish_rate_hz: 50.0
    base_frame: base_link
